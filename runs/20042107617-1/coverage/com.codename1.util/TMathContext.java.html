<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TMathContext.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">codenameone-core-unittests</a> &gt; <a href="index.source.html" class="el_package">com.codename1.util</a> &gt; <span class="el_source">TMathContext.java</span></div><h1>TMathContext.java</h1><pre class="source lang-java linenums">/*
 *  Licensed to the Apache Software Foundation (ASF) under one or more
 *  contributor license agreements.  See the NOTICE file distributed with
 *  this work for additional information regarding copyright ownership.
 *  The ASF licenses this file to You under the Apache License, Version 2.0
 *  (the &quot;License&quot;); you may not use this file except in compliance with
 *  the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

package com.codename1.util;


/**
 * Immutable objects describing settings such as rounding mode and digit
 * precision for the numerical operations provided by class {@link TBigDecimal}.
 */
final class TMathContext {

    /**
     * A {@code MathContext} which corresponds to the IEEE 754r quadruple
     * decimal precision format: 34 digit precision and
     * {@link TRoundingMode#HALF_EVEN} rounding.
     */
<span class="fc" id="L32">    public static final TMathContext DECIMAL128 = new TMathContext(34,</span>
            TRoundingMode.HALF_EVEN);

    /**
     * A {@code MathContext} which corresponds to the IEEE 754r single decimal
     * precision format: 7 digit precision and {@link TRoundingMode#HALF_EVEN}
     * rounding.
     */
<span class="fc" id="L40">    public static final TMathContext DECIMAL32 = new TMathContext(7,</span>
            TRoundingMode.HALF_EVEN);

    /**
     * A {@code MathContext} which corresponds to the IEEE 754r double decimal
     * precision format: 16 digit precision and {@link TRoundingMode#HALF_EVEN}
     * rounding.
     */
<span class="fc" id="L48">    public static final TMathContext DECIMAL64 = new TMathContext(16,</span>
            TRoundingMode.HALF_EVEN);

    /**
     * A {@code MathContext} for unlimited precision with
     * {@link TRoundingMode#HALF_UP} rounding.
     */
<span class="fc" id="L55">    public static final TMathContext UNLIMITED = new TMathContext(0,</span>
            TRoundingMode.HALF_UP);
    /**
     * An array of {@code char} containing: {@code
     * 'p','r','e','c','i','s','i','o','n','='}. It's used to improve the
     * methods related to {@code String} conversion.
     *
     * @see #MathContext(String)
     * @see #toString()
     */
<span class="fc" id="L65">    private final static char[] chPrecision = {'p', 'r', 'e', 'c', 'i', 's',</span>
            'i', 'o', 'n', '='};
    /**
     * An array of {@code char} containing: {@code
     * 'r','o','u','n','d','i','n','g','M','o','d','e','='}. It's used to
     * improve the methods related to {@code String} conversion.
     *
     * @see #MathContext(String)
     * @see #toString()
     */
<span class="fc" id="L75">    private final static char[] chRoundingMode = {'r', 'o', 'u', 'n', 'd',</span>
            'i', 'n', 'g', 'M', 'o', 'd', 'e', '='};
    /**
     * The number of digits to be used for an operation; results are rounded to
     * this precision.
     */
    private int precision;
    /**
     * A {@code RoundingMode} object which specifies the algorithm to be used
     * for rounding.
     */
    private final TRoundingMode roundingMode;

    /**
     * Constructs a new {@code MathContext} with the specified precision and
     * with the rounding mode {@link TRoundingMode#HALF_UP HALF_UP}. If the
     * precision passed is zero, then this implies that the computations have to
     * be performed exact, the rounding mode in this case is irrelevant.
     *
     * @param precision the precision for the new {@code MathContext}.
     * @throws IllegalArgumentException if {@code precision &lt; 0}.
     */
    public TMathContext(int precision) {
<span class="nc" id="L98">        this(precision, TRoundingMode.HALF_UP);</span>
<span class="nc" id="L99">    }</span>

    /**
     * Constructs a new {@code MathContext} with the specified precision and
     * with the specified rounding mode. If the precision passed is zero, then
     * this implies that the computations have to be performed exact, the
     * rounding mode in this case is irrelevant.
     *
     * @param precision    the precision for the new {@code MathContext}.
     * @param roundingMode the rounding mode for the new {@code MathContext}.
     * @throws IllegalArgumentException if {@code precision &lt; 0}.
     * @throws NullPointerException     if {@code roundingMode} is {@code null}.
     */
<span class="fc" id="L112">    public TMathContext(int precision, TRoundingMode roundingMode) {</span>
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">        if (precision &lt; 0) {</span>
<span class="nc" id="L114">            throw new IllegalArgumentException(&quot;Digits &lt; 0&quot;);</span>
        }
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">        if (roundingMode == null) {</span>
<span class="nc" id="L117">            throw new NullPointerException(&quot;null RoundingMode&quot;);</span>
        }
<span class="fc" id="L119">        this.precision = precision;</span>
<span class="fc" id="L120">        this.roundingMode = roundingMode;</span>
<span class="fc" id="L121">    }</span>

    /**
     * Constructs a new {@code MathContext} from a string. The string has to
     * specify the precision and the rounding mode to be used and has to follow
     * the following syntax: &quot;precision=&amp;lt;precision&amp;gt; roundingMode=&amp;lt;roundingMode&amp;gt;&quot;
     * This is the same form as the one returned by the {@link #toString}
     * method.
     *
     * @param val a string describing the precision and rounding mode for the
     *            new {@code MathContext}.
     * @throws IllegalArgumentException if the string is not in the correct format or if the
     *                                  precision specified is &lt; 0.
     */
<span class="fc" id="L135">    public TMathContext(String val) {</span>
<span class="fc" id="L136">        char[] charVal = val.toCharArray();</span>
        int i; // Index of charVal
        int j; // Index of chRoundingMode
        int digit; // It will contain the digit parsed

<span class="pc bpc" id="L141" title="2 of 4 branches missed.">        if ((charVal.length &lt; 27) || (charVal.length &gt; 45)) {</span>
<span class="nc" id="L142">            throw new IllegalArgumentException(&quot;bad string format&quot;);</span>
        }
        // Parsing &quot;precision=&quot; String
<span class="pc bpc" id="L145" title="1 of 4 branches missed.">        for (i = 0; (i &lt; chPrecision.length) &amp;&amp; (charVal[i] == chPrecision[i]); i++) {</span>
            // do nothing
        }

<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        if (i &lt; chPrecision.length) {</span>
<span class="nc" id="L150">            throw new IllegalArgumentException(&quot;bad string format&quot;);</span>
        }
        // Parsing the value for &quot;precision=&quot;...
<span class="fc" id="L153">        digit = Character.digit(charVal[i], 10);</span>
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">        if (digit == -1) {</span>
<span class="nc" id="L155">            throw new IllegalArgumentException(&quot;bad string format&quot;);</span>
        }
<span class="fc" id="L157">        this.precision = this.precision * 10 + digit;</span>
<span class="fc" id="L158">        i++;</span>

        do {
<span class="fc" id="L161">            digit = Character.digit(charVal[i], 10);</span>
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">            if (digit == -1) {</span>
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">                if (charVal[i] == ' ') {</span>
                    // It parsed all the digits
<span class="fc" id="L165">                    i++;</span>
<span class="fc" id="L166">                    break;</span>
                }
                // It isn't  a valid digit, and isn't a white space
<span class="nc" id="L169">                throw new IllegalArgumentException(&quot;bad string format&quot;);</span>
            }
            // Accumulating the value parsed
<span class="nc" id="L172">            this.precision = this.precision * 10 + digit;</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (this.precision &lt; 0) {</span>
<span class="nc" id="L174">                throw new IllegalArgumentException(&quot;bad string format&quot;);</span>
            }
<span class="nc" id="L176">            i++;</span>
<span class="nc" id="L177">        } while (true);</span>
        // Parsing &quot;roundingMode=&quot;
<span class="pc bpc" id="L179" title="1 of 4 branches missed.">        for (j = 0; (j &lt; chRoundingMode.length) &amp;&amp; (charVal[i] == chRoundingMode[j]); i++, j++) {</span>
            // do nothing
        }

<span class="pc bpc" id="L183" title="1 of 2 branches missed.">        if (j &lt; chRoundingMode.length) {</span>
<span class="nc" id="L184">            throw new IllegalArgumentException(&quot;bad string format&quot;);</span>
        }
        // Parsing the value for &quot;roundingMode&quot;...
<span class="fc" id="L187">        this.roundingMode = TRoundingMode.valueOf(String.valueOf(charVal, i, charVal.length - i));</span>
<span class="fc" id="L188">    }</span>

    /* Public Methods */

    /**
     * Returns the precision. The precision is the number of digits used for an
     * operation. Results are rounded to this precision. The precision is
     * guaranteed to be non negative. If the precision is zero, then the
     * computations have to be performed exact, results are not rounded in this
     * case.
     *
     * @return the precision.
     */
    public int getPrecision() {
<span class="fc" id="L202">        return precision;</span>
    }

    /**
     * Returns the rounding mode. The rounding mode is the strategy to be used
     * to round results.
     * &lt;p&gt;
     * The rounding mode is one of
     * {@link TRoundingMode#UP},
     * {@link TRoundingMode#DOWN},
     * {@link TRoundingMode#CEILING},
     * {@link TRoundingMode#FLOOR},
     * {@link TRoundingMode#HALF_UP},
     * {@link TRoundingMode#HALF_DOWN},
     * {@link TRoundingMode#HALF_EVEN}, or
     * {@link TRoundingMode#UNNECESSARY}.
     *
     * @return the rounding mode.
     */
    public TRoundingMode getRoundingMode() {
<span class="fc" id="L222">        return roundingMode;</span>
    }

    /**
     * Returns true if x is a {@code MathContext} with the same precision
     * setting and the same rounding mode as this {@code MathContext} instance.
     *
     * @param x object to be compared.
     * @return {@code true} if this {@code MathContext} instance is equal to the
     * {@code x} argument; {@code false} otherwise.
     */
    @Override
    public boolean equals(Object x) {
<span class="nc bnc" id="L235" title="All 2 branches missed.">        return ((x instanceof TMathContext)</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">                &amp;&amp; (((TMathContext) x).getPrecision() == precision) &amp;&amp; (((TMathContext) x)</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">                .getRoundingMode() == roundingMode));</span>
    }

    /**
     * Returns the hash code for this {@code MathContext} instance.
     *
     * @return the hash code for this {@code MathContext}.
     */
    @Override
    public int hashCode() {
        // Make place for the necessary bits to represent 8 rounding modes
<span class="nc" id="L248">        return ((precision &lt;&lt; 3) | roundingMode.ordinal());</span>
    }

    /**
     * Returns the string representation for this {@code MathContext} instance.
     * The string has the form
     * {@code
     * &quot;precision=&amp;lt;precision&amp;gt; roundingMode=&amp;lt;roundingMode&amp;gt;&quot;
     * } where {@code &amp;lt;precision&amp;gt;} is an integer describing the number
     * of digits used for operations and {@code &amp;lt;roundingMode&amp;gt;} is the
     * string representation of the rounding mode.
     *
     * @return a string representation for this {@code MathContext} instance
     */
    @Override
    public String toString() {

<span class="nc" id="L265">        String sb = String.valueOf(chPrecision) +</span>
                precision +
                ' ' +
<span class="nc" id="L268">                String.valueOf(chRoundingMode) +</span>
                roundingMode;
<span class="nc" id="L270">        return sb;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>